/*! 
 * mindsmash-angular-hotkeys v1.0.0
 * https://github.com/mindsmash/mindsmash-angular-hotkeys
 * Copyright (c) 2015 mindsmash GmbH
 * License: MIT
 */
!function(){"use strict";angular.module("mindsmash.hotkeys",[]).provider("hotkeys",function(){this.$get=function(a,b,c,d,e){function f(a){var b={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓","return":"↩",backspace:"⌫"};a=a.split("+");for(var c=0;c<a.length;c++)"mod"===a[c]&&(d.navigator&&d.navigator.platform.indexOf("Mac")>=0?a[c]="command":a[c]="ctrl"),a[c]=b[a[c]]||a[c];return a.join(" + ")}function g(a,b,c,d,e,f){this.combo=a instanceof Array?a:[a],this.description=b,this.callback=c,this.action=d,this.allowIn=e,this.persistent=f}function h(){for(var a=n.length;a--;){var b=n[a];b&&!b.persistent&&j(b)}}function i(a,b,c,d,e,f){var h,i=["INPUT","SELECT","TEXTAREA"],j=Object.prototype.toString.call(a);if("[object Object]"===j&&(b=a.description,c=a.callback,d=a.action,f=a.persistent,e=a.allowIn,a=a.combo),b instanceof Function?(d=c,c=b,b="$$undefined$$"):angular.isUndefined(b)&&(b="$$undefined$$"),void 0===f&&(f=!0),"function"==typeof c){h=c,e instanceof Array||(e=[]);for(var k,l=0;l<e.length;l++)e[l]=e[l].toUpperCase(),k=i.indexOf(e[l]),-1!==k&&i.splice(k,1);c=function(a){var b=!0,c=a.target||a.srcElement,d=c.nodeName.toUpperCase();if((" "+c.className+" ").indexOf(" mousetrap ")>-1)b=!0;else for(var e=0;e<i.length;e++)if(i[e]===d){b=!1;break}b&&m(h.apply(this,arguments))}}"string"==typeof d?Mousetrap.bind(a,m(c),d):Mousetrap.bind(a,m(c));var o=new g(a,b,c,d,e,f);return n.push(o),o}function j(a){var b=a instanceof g?a.combo:a;if(Mousetrap.unbind(b),angular.isArray(b)){for(var c=!0,d=b.length;d--;)c=j(b[d])&&c;return c}var e=n.indexOf(k(b));return e>-1?(n[e].combo.length>1?n[e].combo.splice(n[e].combo.indexOf(b),1):n.splice(e,1),!0):!1}function k(a){for(var b,c=0;c<n.length;c++)if(b=n[c],b.combo.indexOf(a)>-1)return b;return!1}function l(a){return a.$id in o||(o[a.$id]=[],a.$on("$destroy",function(){for(var b=o[a.$id].length;b--;)j(o[a.$id][b]),delete o[a.$id][b]})),{add:function(b){var c;return c=arguments.length>1?i.apply(this,arguments):i(b),o[a.$id].push(c),this}}}function m(a){return function(c,d){if(a instanceof Array){var e=a[0],f=a[1];a=function(a){f.scope.$eval(e)}}b.$apply(function(){a(c,k(d))})}}Mousetrap.stopCallback=function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:b.contentEditable&&"true"==b.contentEditable},g.prototype.format=function(){for(var a=this.combo[0],b=a.split(/[\s]/),c=0;c<b.length;c++)b[c]=f(b[c]);return b};var n=[],o=[];b.$on("$routeChangeSuccess",function(a,b){h(),b&&b.hotkeys&&angular.forEach(b.hotkeys,function(a){var c=a[2];("string"==typeof c||c instanceof String)&&(a[2]=[c,b]),a[5]=!1,i.apply(this,a)})});var p={add:i,del:j,get:k,bindTo:l,purgeHotkeys:h};return p}}).directive("hotkey",function(a){return{restrict:"A",link:function(b,c,d){var e,f;angular.forEach(b.$eval(d.hotkey),function(b,c){f="string"==typeof d.hotkeyAllowIn?d.hotkeyAllowIn.split(/[\s,]+/):[],e=c,a.add({combo:c,description:d.hotkeyDescription,callback:b,action:d.hotkeyAction,allowIn:f})}),c.bind("$destroy",function(){a.del(e)})}}}).run(function(a,b){try{b.invoke(function(c,d){function e(b,d){angular.isObject(d)||(d={combo:d}),d.callback=function(){c.go(b.name)},a.add(d)}angular.forEach(c.get(),function(a){a.hotkey&&(angular.isFunction(a.hotkey)?d.when(b.invoke(a.hotkey)).then(function(b){e(a,b)}):e(a,a.hotkey))})})}catch(c){console.debug("mindsmash.hotkeys: ui-router seems to be absent")}})}();